"use strict";(self.webpackChunkmisc_stuff=self.webpackChunkmisc_stuff||[]).push([[350],{350:(P,d,h)=>{h.r(d),h.d(d,{SnekModuleModule:()=>y});var g=h(808),c=h(879);class s{constructor(t=0,e=0){this.x=t,this.y=e}add(t){return new s(this.x+t.x,this.y+t.y)}equals(t){return this.x==t.x&&this.y==t.y}static get up(){return new s(0,-1)}static get down(){return new s(0,1)}static get left(){return new s(-1,0)}static get right(){return new s(1,0)}static get zero(){return new s(0,0)}}class S{constructor(t,e,n){this.drawCtx=t,this.numCellsWide=e,this.boardWidthPx=n,this._cellWidthPx=this.boardWidthPx/e}get cellWidthPx(){return this._cellWidthPx}draw(){for(let t=0;t<this.numCellsWide;t++)for(let e=0;e<this.numCellsWide;e++)(t+e)%2!=0&&(this.drawCtx.fillStyle="#acccc6",this.drawCtx.fillRect(t*this.cellWidthPx,e*this.cellWidthPx,this._cellWidthPx,this._cellWidthPx),this.drawCtx.fillStyle="#b8d2cd",this.drawCtx.fillRect(t*this.cellWidthPx,e*this.cellWidthPx,this._cellWidthPx-2,this._cellWidthPx-2))}getCellCoord(t){return t*this.cellWidthPx+this.cellWidthPx/2}getCenterCell(){let t=Math.floor(this.numCellsWide/2);return new s(t,t)}cellIsValid(t){return t.x>=0&&t.x<this.numCellsWide&&t.y>=0&&t.y<this.numCellsWide}}class x{constructor(){this.directionRequests=new s,this.currentDirection=s.zero,this.setupKeyListeners()}setupKeyListeners(){window.addEventListener("keydown",this.onKeyDown.bind(this))}onKeyDown(t){let e=this.arrowKeyToDirection(t.key);0!=e.x&&(this.notMoving()||this.movingOnYAxis()||0!=this.directionRequests.y)&&(this.directionRequests.x=e.x),0!=e.y&&(this.notMoving()||this.movingOnXAxis()||0!=this.directionRequests.x)&&(this.directionRequests.y=e.y)}arrowKeyToDirection(t){switch(t){case"ArrowUp":return s.up;case"ArrowDown":return s.down;case"ArrowLeft":return s.left;case"ArrowRight":return s.right;default:return s.zero}}updateDirection(){return this.currentDirection=this.checkForNewDirection()}checkForNewDirection(){let t=this.consumeRequestedDirection(this.notMoving());return t.equals(s.zero)?this.currentDirection:t}consumeRequestedDirection(t){if((this.movingOnXAxis()||t)&&0!=this.directionRequests.y){let e=new s(0,this.directionRequests.y);return this.directionRequests.y=0,e}if((this.movingOnYAxis()||t)&&0!=this.directionRequests.x){let e=new s(this.directionRequests.x,0);return this.directionRequests.x=0,e}return s.zero}notMoving(){return this.currentDirection.equals(s.zero)}movingOnXAxis(){return 0!=this.currentDirection.x}movingOnYAxis(){return 0!=this.currentDirection.y}}class C{constructor(t,e){this.snakeSegments=[],this.movementProcessor=new x,this.board=e,this.drawCtx=t,this.segmentWidth=.9*e.cellWidthPx;let n=e.getCenterCell();this.headSegment=new m(null,!0),this.headSegment.setPosition(n),this.snakeSegments.push(this.headSegment),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment(),this.attachSegment()}update(){let t=this.movementProcessor.updateDirection(),e=this.headSegment.cellPos.add(t);this.board.cellIsValid(e)&&!this.cellIsInsidePlayer(e)?this.moveInDirection(t):this.die()}cellIsInsidePlayer(t){let e=!1;return this.snakeSegments.forEach(n=>{t.equals(n.cellPos)&&(e=!0)}),e}draw(){this.drawCtx.strokeStyle="rgb(0,100,100)",this.drawCtx.lineWidth=20,this.drawCtx.beginPath(),this.drawCtx.moveTo(this.board.getCellCoord(this.snakeSegments[this.snakeSegments.length-1].cellPos.x),this.board.getCellCoord(this.snakeSegments[this.snakeSegments.length-1].cellPos.y)),[...this.snakeSegments].reverse().forEach(o=>{null!=o.nextSegment&&this.drawCtx.lineTo(this.board.getCellCoord(o.nextSegment.cellPos.x),this.board.getCellCoord(o.nextSegment.cellPos.y))}),this.drawCtx.stroke();this.snakeSegments.forEach((o,u)=>{let l=Math.max(0,1-u/5);this.drawCtx.fillStyle=`rgb(${this.lerp(20,50,l)},${this.lerp(120,175,l)},${this.lerp(120,115,l)})`;let r=this.segmentWidth*(1-u/10);r=Math.max(r,24);let p=this.board.getCellCoord(o.cellPos.x)-r/2,b=this.board.getCellCoord(o.cellPos.y)-r/2;this.drawCtx.fillRect(p,b,r,r)})}lerp(t,e,n){return(1-n)*t+n*e}moveInDirection(t){[...this.snakeSegments].reverse().forEach(e=>{e.followSegment()}),this.headSegment.setPosition(this.headSegment.cellPos.add(t))}eat(){this.attachSegment()}die(){}attachSegment(){let e=new m(this.snakeSegments[this.snakeSegments.length-1]);this.snakeSegments.push(e)}}class m{constructor(t,e=!1){this.isControllable=!1,this._cellPos=s.zero,this.nextSegment=t,this.isControllable=e,null!=this.nextSegment&&(this._cellPos=this.nextSegment.cellPos)}get cellPos(){return new s(this._cellPos.x,this._cellPos.y)}setPosition(t){!this.isControllable||(this._cellPos=t)}followSegment(){var t,e;this.isControllable||(this._cellPos=null!==(e=null===(t=this.nextSegment)||void 0===t?void 0:t.cellPos)&&void 0!==e?e:this._cellPos)}}var a=h(223);const w=["gameCanvas"],f=[{path:"",component:(()=>{class i{constructor(){this.boardSizePx=700,this.numCellsWide=17,this.updateFreqMs=200,this.boardFloatDir=1,this.boardFloatS=10,this.boardFloatMag=5}ngAfterViewInit(){this.initObjects(),this.startUpdateLoops(),this.animateBoard()}initObjects(){this.setUpCanvas(this.gameCanvas),this.board=new S(this.drawCtx,this.numCellsWide,this.boardSizePx),this.player=new C(this.drawCtx,this.board)}setUpCanvas(e){e.nativeElement.width=this.boardSizePx,e.nativeElement.height=this.boardSizePx,this.drawCtx=e.nativeElement.getContext("2d"),this.drawCtx.imageSmoothingEnabled=!0,this.drawCtx.imageSmoothingQuality="high"}startUpdateLoops(){window.setInterval(()=>this.doGameUpdate(),this.updateFreqMs),window.setInterval(()=>this.boardFloatingAnim(this.boardFloatMag),1e3*this.boardFloatS)}doGameUpdate(){this.player.update()}animateBoard(){this.animateCanvas(),this.boardFloatingAnim(0)}animateCanvas(){this.drawCtx.clearRect(0,0,this.boardSizePx,this.boardSizePx),this.board.draw(),this.player.draw(),window.requestAnimationFrame(()=>this.animateCanvas())}boardFloatingAnim(e){this.boardFloatDir=-1*this.boardFloatDir,this.gameCanvas.nativeElement.style.setProperty("--canvas-y",this.boardFloatDir*e+"%"),this.gameCanvas.nativeElement.style.setProperty("--canvas-shifttime",`${this.boardFloatS}s`)}startGame(){}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=a.Xpm({type:i,selectors:[["app-snek-module"]],viewQuery:function(e,n){if(1&e&&a.Gf(w,5),2&e){let o;a.iGM(o=a.CRH())&&(n.gameCanvas=o.first)}},decls:3,vars:0,consts:[["id","snek-body"],["id","gameCanvas"],["gameCanvas",""]],template:function(e,n){1&e&&(a.TgZ(0,"div",0),a._UZ(1,"canvas",1,2),a.qZA())},styles:["#snek-body[_ngcontent-%COMP%]{width:100vw;height:100vh;background-color:#dbe5de;background-image:url(\"data:image/svg+xml,%3Csvg width='100' height='20' viewBox='0 0 100 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M21.184 20c.357-.13.72-.264 1.088-.402l1.768-.661C33.64 15.347 39.647 14 50 14c10.271 0 15.362 1.222 24.629 4.928.955.383 1.869.74 2.75 1.072h6.225c-2.51-.73-5.139-1.691-8.233-2.928C65.888 13.278 60.562 12 50 12c-10.626 0-16.855 1.397-26.66 5.063l-1.767.662c-2.475.923-4.66 1.674-6.724 2.275h6.335zm0-20C13.258 2.892 8.077 4 0 4V2c5.744 0 9.951-.574 14.85-2h6.334zM77.38 0C85.239 2.966 90.502 4 100 4V2c-6.842 0-11.386-.542-16.396-2h-6.225zM0 14c8.44 0 13.718-1.21 22.272-4.402l1.768-.661C33.64 5.347 39.647 4 50 4c10.271 0 15.362 1.222 24.629 4.928C84.112 12.722 89.438 14 100 14v-2c-10.271 0-15.362-1.222-24.629-4.928C65.888 3.278 60.562 2 50 2 39.374 2 33.145 3.397 23.34 7.063l-1.767.662C13.223 10.84 8.163 12 0 12v2z' fill='%2392aca7' fill-opacity='0.4' fill-rule='evenodd'/%3E%3C/svg%3E\")}#gameCanvas[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,calc(-50% + var(--canvas-y)));border:2px solid rgb(230,230,230);border-radius:5px;background-color:#d5e3db;box-shadow:0 30px 100px #026a7c81;max-width:90%;max-height:90%;transition:transform var(--canvas-shifttime) ease-in-out}#player[_ngcontent-%COMP%]{display:none}"]}),i})()}];let v=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=a.oAB({type:i}),i.\u0275inj=a.cJS({imports:[[c.Bz.forChild(f)],c.Bz]}),i})(),y=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=a.oAB({type:i}),i.\u0275inj=a.cJS({imports:[[g.ez,v]]}),i})()}}]);