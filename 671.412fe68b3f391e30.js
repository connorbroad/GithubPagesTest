"use strict";(self.webpackChunkmisc_stuff=self.webpackChunkmisc_stuff||[]).push([[671],{312:(E,C,w)=>{w.r(C),w.d(C,{SnekModuleModule:()=>z});var p=w(808),v=w(879);class g{static lerp(e,t,n){return e*(1-n)+t*n}}class o{constructor(e=0,t=0){this.x=e,this.y=t}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}set(e){this.x=e.x,this.y=e.y}add(e){return new o(this.x+e.x,this.y+e.y)}equals(e){let t=this.round(),n=e.round();return t.x==n.x&&t.y==n.y}get copy(){return new o(this.x,this.y)}static get up(){return new o(0,-1)}static get down(){return new o(0,1)}static get left(){return new o(-1,0)}static get right(){return new o(1,0)}static get zero(){return new o(0,0)}}class P{constructor(e,t,n){this.tileColor="#b8d2cd",this.tileShadowColor="#acccc6",this.tileShadowVisiblePx=3,this.freeCells=[],this.debugFreeCells=!1,this.drawCtx=e,this.numCellsWide=t,this.boardWidthPx=n,this._cellWidthPx=this.boardWidthPx/t,this.reset()}get cellWidthPx(){return this._cellWidthPx}draw(e){for(let t=0;t<this.numCellsWide;t++)for(let n=0;n<this.numCellsWide;n++)(t+n)%2!=0&&(this.drawCtx.fillStyle=this.tileShadowColor,this.drawCtx.fillRect(t*this.cellWidthPx,n*this.cellWidthPx,this._cellWidthPx,this._cellWidthPx),this.drawCtx.fillStyle=this.tileColor,this.drawCtx.fillRect(t*this.cellWidthPx,n*this.cellWidthPx,this._cellWidthPx-this.tileShadowVisiblePx,this._cellWidthPx-this.tileShadowVisiblePx));if(this.debugFreeCells){let t=this.getUnoccupiedCells();for(let n=0;n<t.length;n++)this.drawCtx.fillStyle="rgba(0,25,255, 0.2)",this.drawCtx.fillRect(this.freeCells[n].x*this.cellWidthPx,this.freeCells[n].y*this.cellWidthPx,this._cellWidthPx-this.tileShadowVisiblePx,this._cellWidthPx-this.tileShadowVisiblePx)}}reset(){this.constructFreeCellsArray()}getBoardPosI(e){return e*this.cellWidthPx+this.cellWidthPx/2}getBoardPos(e){return new o(this.getBoardPosI(e.x),this.getBoardPosI(e.y))}getCenterCell(){let e=Math.floor(this.numCellsWide/2);return new o(e,e)}cellIsOnBoard(e){return e.round(),e.x>=0&&e.x<this.numCellsWide&&e.y>=0&&e.y<this.numCellsWide}constructFreeCellsArray(){this.freeCells=[];for(let e=0;e<this.numCellsWide;e++)for(let t=0;t<this.numCellsWide;t++)this.freeCells.push(new o(t,e))}snakeHeadMovedIntoCell(e){this.freeCells=this.freeCells.filter(t=>!t.equals(e))}snakeTailLeftCell(e){this.freeCells.push(e)}getUnoccupiedCells(){return[...this.freeCells]}}class S{constructor(e,t){this.gameControl=e,this.drawCtx=t,this.foods=[],this.spawnSpeedMS=400,this.spinSpeed=.2,this.bounceSpeed=.005,this.minWidth=.4,this.maxWidth=.476,this.color="rgb(0, 150, 180)"}update(){let e=[];for(let t of this.foods)t.wasEaten&&0==t.getScalePerc()&&e.push(t);this.foods=this.foods.filter(t=>e.indexOf(t)<0)}spawnNewPrey(){let e=this.getFreeBoardCell(),t=new M(e,this.spawnSpeedMS);return this.foods.push(t),t}getFreeBoardCell(){let e=this.gameControl.board.getUnoccupiedCells();return e[Math.floor(e.length*Math.random())]}reset(){this.foods=[]}draw(e){for(let t of this.foods){this.drawCtx.fillStyle=this.color;let n=this.gameControl.board.cellWidthPx*this.maxWidth,l=this.gameControl.board.cellWidthPx*this.minWidth,c=Math.sin(t.timeAlive()*this.bounceSpeed),r=t.getScalePerc(),h=g.lerp(l,n,c)*r,d=this.gameControl.board.getBoardPosI(t.cell.x)-h/2,f=this.gameControl.board.getBoardPosI(t.cell.y)-h/2,m=h/2;this.drawCtx.save(),this.drawCtx.translate(d+m,f+m),this.drawCtx.rotate(t.timeAlive()*this.spinSpeed*Math.PI/180),this.drawCtx.fillRect(-m,-m,h,h),this.drawCtx.restore()}}}class M{constructor(e,t){this._wasEaten=!1,this.cell=e,this.timeCreated=Date.now(),this.spawnSpeed=t}get wasEaten(){return this._wasEaten}timeAlive(){return Date.now()-this.timeCreated}timeSinceEaten(){return Date.now()-this.timeEaten}getEaten(){this._wasEaten=!0,this.timeEaten=Date.now()}getScalePerc(){let e=Math.min(1,this.timeAlive()/this.spawnSpeed),t=1;return this._wasEaten&&(t=1-Math.min(1,Math.max(0,this.timeSinceEaten()/this.spawnSpeed))),e*t}}class b{constructor(){this.directionRequests=new o,this.currentDirection=o.zero}onKeyDown(e){let t=this.keyToDirection(e.key),n=!this.isMoving();t.x&&(n||this.movingOnYAxis()||this.directionRequests.y)&&(this.directionRequests.x=t.x),t.y&&(n||this.movingOnXAxis()||this.directionRequests.x)&&(this.directionRequests.y=t.y)}keyToDirection(e){switch(e){case"ArrowUp":return o.up;case"ArrowDown":return o.down;case"ArrowLeft":return o.left;case"ArrowRight":return o.right;default:return o.zero}}updateDirection(){return this.currentDirection=this.checkForNewDirection()}checkForNewDirection(){let e=!this.isMoving(),t=this.consumeRequestedDirection(e);return t.equals(o.zero)?this.currentDirection:t}consumeRequestedDirection(e){if((this.movingOnXAxis()||e)&&this.directionRequests.y){let t=new o(0,this.directionRequests.y);return this.directionRequests.y=0,t}if((this.movingOnYAxis()||e)&&this.directionRequests.x){let t=new o(this.directionRequests.x,0);return this.directionRequests.x=0,t}return o.zero}isMoving(){return!this.currentDirection.equals(o.zero)}movingOnXAxis(){return 0!=this.currentDirection.x}movingOnYAxis(){return 0!=this.currentDirection.y}reset(){this.directionRequests=new o,this.currentDirection=o.zero}}class y{constructor(e,t=!1){var n,l,c,r;this.isControllable=!1,this._cell=o.zero,this._lastCell=o.zero,this._drawnPos=o.zero,this._attachedTo=e,this.isControllable=t,this._cell.set(null!==(l=null===(n=this.attachedTo)||void 0===n?void 0:n.cell)&&void 0!==l?l:this._cell),this._drawnPos.set(null!==(r=null===(c=this.attachedTo)||void 0===c?void 0:c.drawnPos)&&void 0!==r?r:this.cell),this._lastCell.set(this._cell)}get attachedTo(){return this._attachedTo}get cell(){return this._cell.copy}get lastCell(){return this._lastCell.copy}get drawnPos(){return new o(this._drawnPos.x,this._drawnPos.y)}moveToCell(e,t=!1){!this.isControllable||(this._lastCell.set(this._cell),this._cell.set(e),t&&(this._drawnPos.set(this._cell),this._lastCell.set(this._cell)))}followSnake(){this._lastCell.set(this._cell),this.attachedTo&&this._cell.set(this.attachedTo.cell)}moveDrawPosTowardsCell(e){isNaN(e)&&(e=0),this._drawnPos.x=g.lerp(this._drawnPos.x,this.cell.x,Math.min(e,1)),this._drawnPos.y=g.lerp(this._drawnPos.y,this.cell.y,Math.min(e,1))}}class _{constructor(e,t){this.snakeSegments=[],this.movementAntiSmooth=12,this.isDead=!1,this.drawCtx=t,this.g=e,this.movementProcessor=new b,this.snakeHeadWidth=this.g.board.cellWidthPx,this.reset()}reset(){this.snakeSegments=[],this.snakeHeadSegment=new y(null,!0),this.snakeSegments.push(this.snakeHeadSegment);let e=this.g.board.getCenterCell();this.snakeHeadSegment.moveToCell(e,!0),this.g.board.snakeHeadMovedIntoCell(e),this.movementProcessor.reset(),this.isDead=!1,this.grow(),this.grow()}onKeyDown(e){this.movementProcessor.onKeyDown(e)}update(){let e=this.movementProcessor.updateDirection(),t=this.snakeHeadSegment.cell.add(e);this.cellWillKillPlayer(t)&&this.die(),this.moveIntoCell(t),this.food.cell.equals(this.snakeHeadSegment.cell)&&this.eat()}cellWillKillPlayer(e){let t=this.cellIsInsidePlayerBody(e);return!this.g.board.cellIsOnBoard(e)||t}tail(){return this.snakeSegments[this.snakeSegments.length-1]}cellIsInsidePlayerBody(e){for(let t=0;t<this.snakeSegments.length-1;t++)if(this.snakeSegments[t].cell.equals(e))return!0;return!1}moveIntoCell(e){let t=this.tail().cell;[...this.snakeSegments].reverse().forEach(l=>{l.followSnake()}),this.snakeHeadSegment.moveToCell(e);let n=this.tail().cell;t.equals(n)||this.g.board.snakeTailLeftCell(t),this.g.board.snakeHeadMovedIntoCell(e)}die(){this.isDead=!0,this.g.onPlayerDied()}eat(){this.food.getEaten(),this.grow(),this.g.onPreyEaten()}setPrey(e){this.food=e}grow(){let e=new y(this.tail());this.snakeSegments.push(e)}draw(e){this.snakeSegments.forEach((r,h)=>{r.moveDrawPosTowardsCell(e*this.movementAntiSmooth)}),this.drawCtx.lineWidth=.7*this.snakeHeadWidth,this.drawCtx.strokeStyle="rgb(0,100,100)",this.drawCtx.lineJoin="round",this.drawCtx.lineCap="round",this.drawCtx.beginPath();let n=this.g.board.getBoardPos(this.tail().drawnPos);this.drawCtx.moveTo(n.x,n.y);for(let r=this.snakeSegments.length-1;r>=0;--r){let h=this.snakeSegments[r];if(0==r){let d=this.g.board.getBoardPos(h.drawnPos);this.drawCtx.lineTo(d.x,d.y)}else{let d=this.g.board.getBoardPos(h.cell);this.drawCtx.lineTo(d.x,d.y)}}this.drawCtx.stroke();let l=this.isDead?{r:200,g:50,b:50}:{r:50,g:175,b:115},c=this.isDead?{r:50,g:50,b:50}:{r:20,g:120,b:120};for(let r=this.snakeSegments.length-1;r>=0;r--){let h=this.snakeSegments[r],d=Math.max(0,1-r/5);this.drawCtx.fillStyle=`rgb(${g.lerp(c.r,l.r,d)}, ${g.lerp(c.g,l.g,d)}, ${g.lerp(c.b,l.b,d)})`;let u=this.snakeHeadWidth*(1-r/12);u=Math.max(.3*this.snakeHeadWidth,u);let R=this.g.board.getBoardPosI(h.drawnPos.x)-u/2,B=this.g.board.getBoardPosI(h.drawnPos.y)-u/2,x=u/2;this.drawCtx.save(),this.drawCtx.translate(R+x,B+x),this.drawCtx.rotate(45*Math.PI/180),this.drawCtx.fillRect(-x,-x,u,u),this.drawCtx.restore()}}}class k{constructor(e){this.arrowKeys=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],this.spaceCode="Space",this.updateFreqMs=250,this.boardNumCellsWide=9,this.score=0,this.startTime=0,this.finalTimeStr="",this._gameState=a.MainMenu,this._gameState=a.MainMenu,this._boardSizePx=55.5*this.boardNumCellsWide,this.board=new P(e,this.boardNumCellsWide,this.boardSizePx),this.player=new _(this,e),this.foodDispenser=new S(this,e),this.setUpKeyboardListener(),this.resetGame()}get boardSizePx(){return this._boardSizePx}get gameState(){return this._gameState}get onMainMenu(){return this._gameState==a.MainMenu}get isPlaying(){return this._gameState==a.Playing}get isGameOver(){return this._gameState==a.GameOver}get playerHasWon(){return this._gameState==a.Victorious}setUpKeyboardListener(){window.addEventListener("keydown",this.onKeyDown.bind(this))}onKeyDown(e){switch(this.gameState){case a.Playing:this.player.onKeyDown(e);break;case a.MainMenu:this.arrowKeys.includes(e.key)&&this.startGame(e);break;case a.GameOver:case a.Victorious:e.code==this.spaceCode&&this.goToMainMenu()}}draw(e){this.board.draw(e),this.foodDispenser.draw(e),this.player.draw(e)}startGame(e){this._gameState=a.Playing,this.startTime=Date.now(),this.player.onKeyDown(e),this.startUpdateLoop()}startUpdateLoop(){this.gameIntervalId=window.setInterval(()=>this.doGameUpdate(),this.updateFreqMs)}doGameUpdate(){this.foodDispenser.update(),this.player.update()}gameOver(e){this._gameState=e?a.Victorious:a.GameOver,window.clearInterval(this.gameIntervalId),this.finalTimeStr=((Date.now()-this.startTime)/1e3).toFixed(2)}goToMainMenu(){this._gameState=a.MainMenu,this.resetGame()}resetGame(){this.foodDispenser.reset(),this.board.reset(),this.player.reset(),this.score=0,this.spawnPrey()}onPreyEaten(){this.score++,this.board.getUnoccupiedCells().length>0?this.spawnPrey():this.gameOver(!0)}spawnPrey(){let e=this.foodDispenser.spawnNewPrey();this.player.setPrey(e)}onPlayerDied(){this.gameOver(!1)}}var a=(()=>{return(s=a||(a={}))[s.MainMenu=0]="MainMenu",s[s.Playing=1]="Playing",s[s.GameOver=2]="GameOver",s[s.Victorious=3]="Victorious",a;var s})(),i=w(223);const D=["gameCanvas"];function W(s,e){1&s&&(i.TgZ(0,"div",8),i._uU(1," Press any arrow key to start! :D "),i.qZA())}function T(s,e){if(1&s&&(i.TgZ(0,"div",9)(1,"div",10),i._uU(2),i.qZA(),i.TgZ(3,"h1"),i._uU(4,"GAME OVER"),i.qZA(),i._uU(5," Press space to reset "),i.qZA()),2&s){const t=i.oxw();i.xp6(2),i.hij("Score: ",t.gameControl.score,"")}}function A(s,e){if(1&s&&(i.TgZ(0,"div",11)(1,"div",10),i._uU(2),i.qZA(),i.TgZ(3,"h1"),i._uU(4,"\u{1f60e} Victory! \u{1f60e}"),i.qZA(),i._uU(5," Press space to reset "),i.qZA()),2&s){const t=i.oxw();i.xp6(2),i.hij("Time: ",t.gameControl.finalTimeStr,"s")}}function I(s,e){if(1&s&&(i.TgZ(0,"div",12)(1,"div",13),i._uU(2),i.qZA()()),2&s){const t=i.oxw();i.xp6(2),i.hij(" Score: ",t.gameControl.score," ")}}const O=[{path:"",component:(()=>{class s{constructor(){}ngOnInit(){}ngAfterViewInit(){this.initObjects(),this.animateCanvas()}initObjects(){this.drawingContext=this.gameCanvas.nativeElement.getContext("2d"),this.gameControl=new k(this.drawingContext),this.setUpCanvas(this.gameCanvas)}setUpCanvas(t){t.nativeElement.width=this.gameControl.boardSizePx,t.nativeElement.height=this.gameControl.boardSizePx}animateCanvas(t=0){let n=t-this.timeLastFrame;this.timeLastFrame=t,n/=1e3;let c=5*Math.sin(Date.now()/5e3);this.gameCanvas.nativeElement.style.setProperty("--canvas-y",`${c}%`),this.drawingContext.clearRect(0,0,this.gameControl.boardSizePx,this.gameControl.boardSizePx),this.gameControl.draw(n),window.requestAnimationFrame(r=>this.animateCanvas(r))}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=i.Xpm({type:s,selectors:[["app-snek-module"]],viewQuery:function(t,n){if(1&t&&i.Gf(D,5),2&t){let l;i.iGM(l=i.CRH())&&(n.gameCanvas=l.first)}},decls:8,vars:4,consts:[["id","game-bg"],["id","menu-text-container"],["class","menu-text",4,"ngIf"],["class","menu-text text-light",4,"ngIf"],["class","menu-text text-light victory-text",4,"ngIf"],["id","game-text-container",4,"ngIf"],["id","gameCanvas"],["gameCanvas",""],[1,"menu-text"],[1,"menu-text","text-light"],[1,"score-text"],[1,"menu-text","text-light","victory-text"],["id","game-text-container"],["id","ingame-score"]],template:function(t,n){if(1&t&&(i.TgZ(0,"div",0)(1,"div",1),i.YNc(2,W,2,0,"div",2),i.YNc(3,T,6,1,"div",3),i.YNc(4,A,6,1,"div",4),i.qZA(),i.YNc(5,I,3,1,"div",5),i._UZ(6,"canvas",6,7),i.qZA()),2&t){let l,c,r,h;i.xp6(2),i.Q6J("ngIf",null!==(l=null==n.gameControl?null:n.gameControl.onMainMenu)&&void 0!==l&&l),i.xp6(1),i.Q6J("ngIf",null!==(c=null==n.gameControl?null:n.gameControl.isGameOver)&&void 0!==c&&c),i.xp6(1),i.Q6J("ngIf",null!==(r=null==n.gameControl?null:n.gameControl.playerHasWon)&&void 0!==r&&r),i.xp6(1),i.Q6J("ngIf",null!==(h=null==n.gameControl?null:n.gameControl.isPlaying)&&void 0!==h&&h)}},directives:[p.O5],styles:["@import\"https://fonts.googleapis.com/css2?family=Fredoka One&display=swap\";*[_ngcontent-%COMP%]{font-family:Fredoka One,Arial,Helvetica,sans-serif}#game-bg[_ngcontent-%COMP%]{width:100vw;height:100vh;background-color:#dbe5de;background-image:url(\"data:image/svg+xml,%3Csvg width='100' height='20' viewBox='0 0 100 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M21.184 20c.357-.13.72-.264 1.088-.402l1.768-.661C33.64 15.347 39.647 14 50 14c10.271 0 15.362 1.222 24.629 4.928.955.383 1.869.74 2.75 1.072h6.225c-2.51-.73-5.139-1.691-8.233-2.928C65.888 13.278 60.562 12 50 12c-10.626 0-16.855 1.397-26.66 5.063l-1.767.662c-2.475.923-4.66 1.674-6.724 2.275h6.335zm0-20C13.258 2.892 8.077 4 0 4V2c5.744 0 9.951-.574 14.85-2h6.334zM77.38 0C85.239 2.966 90.502 4 100 4V2c-6.842 0-11.386-.542-16.396-2h-6.225zM0 14c8.44 0 13.718-1.21 22.272-4.402l1.768-.661C33.64 5.347 39.647 4 50 4c10.271 0 15.362 1.222 24.629 4.928C84.112 12.722 89.438 14 100 14v-2c-10.271 0-15.362-1.222-24.629-4.928C65.888 3.278 60.562 2 50 2 39.374 2 33.145 3.397 23.34 7.063l-1.767.662C13.223 10.84 8.163 12 0 12v2z' fill='%2392aca7' fill-opacity='0.4' fill-rule='evenodd'/%3E%3C/svg%3E\");position:relative;display:inline-block}#gameCanvas[_ngcontent-%COMP%]{position:relative;top:50%;left:50%;transform:translate(-50%,calc(-50% + var(--canvas-y)));border:2px solid rgb(230,230,230);border-radius:25px;background-color:#d5e3db;box-shadow:0 30px 100px #026a7c81;max-width:90%;max-height:90%;transition:transform var(--canvas-shifttime) ease-in-out}#menu-text-container[_ngcontent-%COMP%]{z-index:1;width:100vw;height:100vh;position:absolute;text-align:center;display:flex;justify-content:center;align-items:center}.menu-text[_ngcontent-%COMP%]{font-size:30px}.text-light[_ngcontent-%COMP%]{text-shadow:0px 5px 30px rgba(255,255,255,.534)}.victory-text[_ngcontent-%COMP%]{--victory-text-outline: rgb(255, 255, 255);text-shadow:-1px -1px 0 var(--victory-text-outline),1px -1px 0 var(--victory-text-outline),-1px 1px 0 var(--victory-text-outline),1px 1px 0 var(--victory-text-outline)}#game-text-container[_ngcontent-%COMP%]{z-index:1;width:100vw;height:100vh;position:absolute;font-size:30px;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center}#ingame-score[_ngcontent-%COMP%]{margin-top:auto;margin-bottom:10px;bottom:0}"]}),s})()}];let q=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=i.oAB({type:s}),s.\u0275inj=i.cJS({imports:[[v.Bz.forChild(O)],v.Bz]}),s})(),z=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=i.oAB({type:s}),s.\u0275inj=i.cJS({imports:[[p.ez,q]]}),s})()}}]);