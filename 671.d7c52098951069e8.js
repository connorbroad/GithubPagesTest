"use strict";(self.webpackChunkmisc_stuff=self.webpackChunkmisc_stuff||[]).push([[671],{312:(F,p,g)=>{g.r(p),g.d(p,{SnekModuleModule:()=>z});var v=g(808),y=g(879);class m{static lerp(e,t,n){return e*(1-n)+t*n}}class r{constructor(e=0,t=0){this.x=e,this.y=t}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}set(e){this.x=e.x,this.y=e.y}add(e){return new r(this.x+e.x,this.y+e.y)}equals(e){return this.x==e.x&&this.y==e.y}static get up(){return new r(0,-1)}static get down(){return new r(0,1)}static get left(){return new r(-1,0)}static get right(){return new r(1,0)}static get zero(){return new r(0,0)}}class M{constructor(e,t,n){this.tileColor="#b8d2cd",this.tileShadowColor="#acccc6",this.tileShadowVisiblePx=3,this.freeCells=[],this.drawCtx=e,this.numCellsWide=t,this.boardWidthPx=n,this._cellWidthPx=this.boardWidthPx/t,this.reset()}get cellWidthPx(){return this._cellWidthPx}draw(e){for(let t=0;t<this.numCellsWide;t++)for(let n=0;n<this.numCellsWide;n++)(t+n)%2!=0&&(this.drawCtx.fillStyle=this.tileShadowColor,this.drawCtx.fillRect(t*this.cellWidthPx,n*this.cellWidthPx,this._cellWidthPx,this._cellWidthPx),this.drawCtx.fillStyle=this.tileColor,this.drawCtx.fillRect(t*this.cellWidthPx,n*this.cellWidthPx,this._cellWidthPx-this.tileShadowVisiblePx,this._cellWidthPx-this.tileShadowVisiblePx))}reset(){this.constructFreeCellsArray()}getBoardPos(e){return e*this.cellWidthPx+this.cellWidthPx/2}getCenterCell(){let e=Math.floor(this.numCellsWide/2);return new r(e,e)}cellIsOnBoard(e){return e.round(),e.x>=0&&e.x<this.numCellsWide&&e.y>=0&&e.y<this.numCellsWide}constructFreeCellsArray(){this.freeCells=[];for(let e=0;e<this.numCellsWide;e++)for(let t=0;t<this.numCellsWide;t++)this.freeCells.push(new r(t,e))}snakeHeadMovedIntoCell(e){this.freeCells=this.freeCells.filter(t=>!t.equals(e))}snakeTailLeftCell(e){this.freeCells.push(e)}getUnoccupiedCells(){return[...this.freeCells]}}class b{constructor(e,t){this.gameControl=e,this.drawCtx=t,this.foods=[]}spawnNewPrey(){let e=this.getFreeBoardCell(),t=new k(e);return this.foods.push(t),t}getFreeBoardCell(){let e=this.gameControl.board.getUnoccupiedCells();return e[Math.floor(e.length*Math.random())]}reset(){this.foods=[]}draw(e){for(let t of this.foods){if(!t.enabled)continue;let n=200,o=5;this.drawCtx.fillStyle="rgb(0,150,180)";let a=this.gameControl.board.cellWidthPx/2.1,h=this.gameControl.board.cellWidthPx/2.5,d=Math.sin(t.timeAlive()/n),x=t.getSpawnScalePerc(),u=m.lerp(h,a,d)*x,c=this.gameControl.board.getBoardPos(t.cell.x)-u/2,f=this.gameControl.board.getBoardPos(t.cell.y)-u/2,w=u/2;this.drawCtx.save(),this.drawCtx.translate(c+w,f+w),this.drawCtx.rotate(t.timeAlive()/o*Math.PI/180),this.drawCtx.fillRect(-w,-w,u,u),this.drawCtx.restore()}}}class k{constructor(e){this.spawnSpeed=400,this._enabled=!0,this.wasEaten=!1,this.cell=e,this.timeCreated=Date.now()}get enabled(){return this._enabled}timeAlive(){return Date.now()-this.timeCreated}timeSinceEaten(){return Date.now()-this.timeEaten}getEaten(){this.wasEaten=!0,this.timeEaten=Date.now()}getSpawnScalePerc(){let e=Math.min(1,this.timeAlive()/this.spawnSpeed),t=1;return this.wasEaten&&(t=1-Math.min(1,Math.max(0,this.timeSinceEaten()/this.spawnSpeed)),0==t&&(this._enabled=!1)),e*t}}var P=g(579);class _{constructor(){this.directionRequests=new r,this.currentDirection=r.zero}onKeyDown(e){let t=this.keyToDirection(e.key),n=!this.isMoving();t.x&&(n||this.movingOnYAxis()||this.directionRequests.y)&&(this.directionRequests.x=t.x),t.y&&(n||this.movingOnXAxis()||this.directionRequests.x)&&(this.directionRequests.y=t.y)}keyToDirection(e){switch(e){case"ArrowUp":return r.up;case"ArrowDown":return r.down;case"ArrowLeft":return r.left;case"ArrowRight":return r.right;default:return r.zero}}updateDirection(){return this.currentDirection=this.checkForNewDirection()}checkForNewDirection(){let e=!this.isMoving(),t=this.consumeRequestedDirection(e);return t.equals(r.zero)?this.currentDirection:t}consumeRequestedDirection(e){if((this.movingOnXAxis()||e)&&this.directionRequests.y){let t=new r(0,this.directionRequests.y);return this.directionRequests.y=0,t}if((this.movingOnYAxis()||e)&&this.directionRequests.x){let t=new r(this.directionRequests.x,0);return this.directionRequests.x=0,t}return r.zero}isMoving(){return!this.currentDirection.equals(r.zero)}movingOnXAxis(){return 0!=this.currentDirection.x}movingOnYAxis(){return 0!=this.currentDirection.y}reset(){this.directionRequests=new r,this.currentDirection=r.zero}}class S{constructor(e,t=!1){var n,o,a,h;this.isControllable=!1,this._cell=r.zero,this._drawnPos=r.zero,this.attachedTo=e,this.isControllable=t,this._cell=null!==(o=null===(n=this.attachedTo)||void 0===n?void 0:n.cell)&&void 0!==o?o:this._cell,this._drawnPos.set(null!==(h=null===(a=this.attachedTo)||void 0===a?void 0:a.drawnPos)&&void 0!==h?h:this.cell)}get cell(){return new r(this._cell.x,this._cell.y)}get drawnPos(){return new r(this._drawnPos.x,this._drawnPos.y)}moveToCell(e,t=!1){!this.isControllable||(this._cell=e,t&&(this._drawnPos=this._cell))}followSnake(){!this.attachedTo||(this._cell=this.attachedTo.cell)}moveDrawPosTowardsCell(e){isNaN(e)&&(e=0),this._drawnPos.x=m.lerp(this._drawnPos.x,this.cell.x,Math.min(e,1)),this._drawnPos.y=m.lerp(this._drawnPos.y,this.cell.y,Math.min(e,1))}}class D{constructor(e,t){this.snakeSegments=[],this.movementAntiSmooth=12,this.deathEvent=new P.x,this.atePreyEvent=new P.x,this.isDead=!1,this.drawCtx=t,this.gameControl=e,this.movementProcessor=new _,this.snakeHeadWidth=1*this.gameControl.board.cellWidthPx,this.snakeHeadSegment=new S(null,!0),this.reset()}reset(){this.snakeSegments=[];let e=this.gameControl.board.getCenterCell();this.snakeHeadSegment.moveToCell(e,!0),this.gameControl.board.snakeHeadMovedIntoCell(e),this.snakeSegments.push(this.snakeHeadSegment),this.movementProcessor.reset(),this.isDead=!1,this.grow(),this.grow()}onKeyDown(e){this.movementProcessor.onKeyDown(e)}update(){let e=this.movementProcessor.updateDirection(),t=this.snakeHeadSegment.cell.add(e);this.cellIsInvalid(t)&&this.die(),this.moveIntoCell(t),this.prey.cell.round().equals(this.snakeHeadSegment.cell.round())&&(this.eat(),this.atePreyEvent.next(!0))}cellIsInvalid(e){return!this.gameControl.board.cellIsOnBoard(e)||this.cellIsInsidePlayer(e)}cellIsInsidePlayer(e){for(let t=1;t<this.snakeSegments.length-1;t++)if(this.snakeSegments[t].cell.round().equals(e.round()))return!0;return!1}moveIntoCell(e){let t=this.snakeSegments[this.snakeSegments.length-1].cell;[...this.snakeSegments].reverse().forEach(o=>{o.followSnake()}),this.snakeHeadSegment.moveToCell(e);let n=this.snakeSegments[this.snakeSegments.length-1].cell;t.round().equals(n.round())||this.gameControl.board.snakeTailLeftCell(t),this.gameControl.board.snakeHeadMovedIntoCell(e)}die(){this.isDead=!0,this.deathEvent.next(!0)}eat(){this.prey.getEaten(),this.grow()}setPrey(e){this.prey=e}grow(){let t=new S(this.snakeSegments[this.snakeSegments.length-1]);this.snakeSegments.push(t)}draw(e){this.snakeSegments.forEach((a,h)=>{a.moveDrawPosTowardsCell(e*this.movementAntiSmooth)});let t=.7*this.snakeHeadWidth;this.drawCtx.strokeStyle="rgb(0,100,100)",this.drawCtx.lineWidth=t,this.drawCtx.lineJoin="round",this.drawCtx.lineCap="round",this.drawCtx.beginPath(),this.drawCtx.moveTo(this.gameControl.board.getBoardPos(this.snakeSegments[this.snakeSegments.length-1].drawnPos.x),this.gameControl.board.getBoardPos(this.snakeSegments[this.snakeSegments.length-1].drawnPos.y)),[...this.snakeSegments].reverse().forEach(a=>{null!=a.attachedTo&&this.drawCtx.lineTo(this.gameControl.board.getBoardPos(a.attachedTo.drawnPos.x),this.gameControl.board.getBoardPos(a.attachedTo.drawnPos.y))}),this.drawCtx.stroke();let n=this.isDead?{r:200,g:50,b:50}:{r:50,g:175,b:115},o=this.isDead?{r:50,g:50,b:50}:{r:20,g:120,b:120};for(let a=this.snakeSegments.length-1;a>=0;a--){let h=this.snakeSegments[a],d=Math.max(0,1-a/5);this.drawCtx.fillStyle=`rgb(${m.lerp(o.r,n.r,d)}, ${m.lerp(o.g,n.g,d)}, ${m.lerp(o.b,n.b,d)})`;let c=this.snakeHeadWidth*(1-a/12);c=Math.max(.3*this.snakeHeadWidth,c);let f=this.gameControl.board.getBoardPos(h.drawnPos.x)-c/2,w=this.gameControl.board.getBoardPos(h.drawnPos.y)-c/2,C=c/2;this.drawCtx.save(),this.drawCtx.translate(f+C,w+C),this.drawCtx.rotate(45*Math.PI/180),this.drawCtx.fillRect(-C,-C,c,c),this.drawCtx.restore()}}}class A{constructor(e,t){this.score=0,this._gameState=l.MainMenu,this.boardNumCellsWide=9,this.updateFreqMs=250,this.arrowKeys=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],this.spaceCode="Space",this._gameState=l.MainMenu,this.board=new M(e,this.boardNumCellsWide,t),this.player=new D(this,e),this.player.deathEvent.subscribe(()=>{this.gameOver(!1)}),this.player.atePreyEvent.subscribe(()=>{this.onPreyEaten()}),this.preyDispenser=new b(this,e),this.setUpKeyboardListener(),this.resetGame()}get gameState(){return this._gameState}get onMainMenu(){return this._gameState==l.MainMenu}get isPlaying(){return this._gameState==l.Playing}get isGameOver(){return this._gameState==l.GameOver}get playerHasWon(){return this._gameState==l.Victorious}setUpKeyboardListener(){window.addEventListener("keydown",this.onKeyDown.bind(this))}onKeyDown(e){switch(this.gameState){case l.Playing:this.player.onKeyDown(e);break;case l.MainMenu:this.arrowKeys.includes(e.key)&&this.startGame(e);break;case l.GameOver:case l.Victorious:e.code==this.spaceCode&&this.goToMainMenu()}}draw(e){this.board.draw(e),this.preyDispenser.draw(e),this.player.draw(e)}startGame(e){this.player.onKeyDown(e),this._gameState=l.Playing,this.startUpdateLoop()}startUpdateLoop(){this.gameIntervalId=window.setInterval(()=>this.doGameUpdate(),this.updateFreqMs)}doGameUpdate(){this.player.update()}gameOver(e){this._gameState=e?l.Victorious:l.GameOver,window.clearInterval(this.gameIntervalId)}goToMainMenu(){this._gameState=l.MainMenu,this.resetGame()}resetGame(){this.preyDispenser.reset(),this.board.reset(),this.player.reset(),this.score=0,this.spawnPrey()}onPreyEaten(){this.score++,this.board.getUnoccupiedCells().length>0?this.spawnPrey():this.gameOver(!0)}spawnPrey(){let e=this.preyDispenser.spawnNewPrey();this.player.setPrey(e)}}var l=(()=>{return(s=l||(l={}))[s.MainMenu=0]="MainMenu",s[s.Playing=1]="Playing",s[s.GameOver=2]="GameOver",s[s.Victorious=3]="Victorious",l;var s})(),i=g(223);const W=["gameCanvas"];function T(s,e){1&s&&(i.TgZ(0,"div",7),i._uU(1," Press any arrow key to start! :D "),i.qZA())}function q(s,e){if(1&s&&(i.TgZ(0,"div",8)(1,"div",9),i._uU(2),i.qZA(),i.TgZ(3,"h1"),i._uU(4,"GAME OVER"),i.qZA(),i._uU(5," Press space to reset "),i.qZA()),2&s){const t=i.oxw();i.xp6(2),i.hij("Score: ",t.gameControl.score,"")}}function E(s,e){if(1&s&&(i.TgZ(0,"div",7)(1,"div",9),i._uU(2),i.qZA(),i.TgZ(3,"h1"),i._uU(4,"\u{1f60e} Victory! \u{1f60e}"),i.qZA(),i._uU(5," Press space to reset "),i.qZA()),2&s){const t=i.oxw();i.xp6(2),i.hij("Score: ",t.gameControl.score,"")}}function I(s,e){if(1&s&&(i.TgZ(0,"div",10)(1,"div",11),i._uU(2),i.qZA()()),2&s){const t=i.oxw();i.xp6(2),i.hij(" Score: ",t.gameControl.score," ")}}const O=[{path:"",component:(()=>{class s{constructor(){this.boardSizePx=700,this.boardFloatMag=5,this.boardFloatS=10,this.boardFloatDir=1}ngOnInit(){}ngAfterViewInit(){this.initObjects(),this.doAnimation()}initObjects(){this.setUpCanvas(this.gameCanvas),this.gameControl=new A(this.drawingContext,this.boardSizePx)}setUpCanvas(t){t.nativeElement.width=this.boardSizePx,t.nativeElement.height=this.boardSizePx,this.drawingContext=t.nativeElement.getContext("2d"),window.setInterval(()=>this.boardFloatingAnim(this.boardFloatMag),1e3*this.boardFloatS)}doAnimation(){this.animateCanvas(0),this.boardFloatingAnim(0)}animateCanvas(t){let n=t-this.timeLastFrame;this.timeLastFrame=t,n/=1e3;let o=Math.sin(Date.now()/5e3)*this.boardFloatMag;this.gameCanvas.nativeElement.style.setProperty("--canvas-y",`${o}%`),this.drawingContext.clearRect(0,0,this.boardSizePx,this.boardSizePx),this.gameControl.draw(n),window.requestAnimationFrame(a=>this.animateCanvas(a))}boardFloatingAnim(t){}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=i.Xpm({type:s,selectors:[["app-snek-module"]],viewQuery:function(t,n){if(1&t&&i.Gf(W,5),2&t){let o;i.iGM(o=i.CRH())&&(n.gameCanvas=o.first)}},decls:8,vars:4,consts:[["id","game-bg"],["id","menu-text-container"],["class","menu-text",4,"ngIf"],["class","menu-text text-light",4,"ngIf"],["id","game-text-container",4,"ngIf"],["id","gameCanvas"],["gameCanvas",""],[1,"menu-text"],[1,"menu-text","text-light"],[1,"score-text"],["id","game-text-container"],["id","ingame-score"]],template:function(t,n){if(1&t&&(i.TgZ(0,"div",0)(1,"div",1),i.YNc(2,T,2,0,"div",2),i.YNc(3,q,6,1,"div",3),i.YNc(4,E,6,1,"div",2),i.qZA(),i.YNc(5,I,3,1,"div",4),i._UZ(6,"canvas",5,6),i.qZA()),2&t){let o,a,h,d;i.xp6(2),i.Q6J("ngIf",null!==(o=null==n.gameControl?null:n.gameControl.onMainMenu)&&void 0!==o&&o),i.xp6(1),i.Q6J("ngIf",null!==(a=null==n.gameControl?null:n.gameControl.isGameOver)&&void 0!==a&&a),i.xp6(1),i.Q6J("ngIf",null!==(h=null==n.gameControl?null:n.gameControl.playerHasWon)&&void 0!==h&&h),i.xp6(1),i.Q6J("ngIf",null!==(d=null==n.gameControl?null:n.gameControl.isPlaying)&&void 0!==d&&d)}},directives:[v.O5],styles:["@import\"https://fonts.googleapis.com/css2?family=Fredoka One&display=swap\";*[_ngcontent-%COMP%]{font-family:Fredoka One,Arial,Helvetica,sans-serif}#game-bg[_ngcontent-%COMP%]{width:100vw;height:100vh;background-color:#dbe5de;background-image:url(\"data:image/svg+xml,%3Csvg width='100' height='20' viewBox='0 0 100 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M21.184 20c.357-.13.72-.264 1.088-.402l1.768-.661C33.64 15.347 39.647 14 50 14c10.271 0 15.362 1.222 24.629 4.928.955.383 1.869.74 2.75 1.072h6.225c-2.51-.73-5.139-1.691-8.233-2.928C65.888 13.278 60.562 12 50 12c-10.626 0-16.855 1.397-26.66 5.063l-1.767.662c-2.475.923-4.66 1.674-6.724 2.275h6.335zm0-20C13.258 2.892 8.077 4 0 4V2c5.744 0 9.951-.574 14.85-2h6.334zM77.38 0C85.239 2.966 90.502 4 100 4V2c-6.842 0-11.386-.542-16.396-2h-6.225zM0 14c8.44 0 13.718-1.21 22.272-4.402l1.768-.661C33.64 5.347 39.647 4 50 4c10.271 0 15.362 1.222 24.629 4.928C84.112 12.722 89.438 14 100 14v-2c-10.271 0-15.362-1.222-24.629-4.928C65.888 3.278 60.562 2 50 2 39.374 2 33.145 3.397 23.34 7.063l-1.767.662C13.223 10.84 8.163 12 0 12v2z' fill='%2392aca7' fill-opacity='0.4' fill-rule='evenodd'/%3E%3C/svg%3E\");position:relative;display:inline-block}#gameCanvas[_ngcontent-%COMP%]{position:relative;top:50%;left:50%;transform:translate(-50%,calc(-50% + var(--canvas-y)));border:2px solid rgb(230,230,230);border-radius:5px;background-color:#d5e3db;box-shadow:0 30px 100px #026a7c81;max-width:90%;max-height:90%;transition:transform var(--canvas-shifttime) ease-in-out}#menu-text-container[_ngcontent-%COMP%]{z-index:1;width:100vw;height:100vh;position:absolute;text-align:center;display:flex;justify-content:center;align-items:center}.menu-text[_ngcontent-%COMP%]{font-size:30px}.text-light[_ngcontent-%COMP%]{text-shadow:0px 5px 30px rgba(255,255,255,.534)}#game-text-container[_ngcontent-%COMP%]{z-index:1;width:100vw;height:100vh;position:absolute;font-size:30px;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center}#ingame-score[_ngcontent-%COMP%]{margin-top:auto;margin-bottom:10px;bottom:0}"]}),s})()}];let R=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=i.oAB({type:s}),s.\u0275inj=i.cJS({imports:[[y.Bz.forChild(O)],y.Bz]}),s})(),z=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=i.oAB({type:s}),s.\u0275inj=i.cJS({imports:[[v.ez,R]]}),s})()}}]);